<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yo!</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Yo!">
    <meta name="description" content="Get attention from far away - Perfect for airports, emergencies, and distance communication">

    <!-- Web App Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkF5ZSwgWW8hIiwKICAic2hvcnRfbmFtZSI6ICJBeWUsIFlvISIsCiAgImRlc2NyaXB0aW9uIjogIkdldCBhdHRlbnRpb24gZnJvbSBmYXIgYXdheSAtIFBlcmZlY3QgZm9yIGFpcnBvcnRzLCBlbWVyZ2VuY2llcywgYW5kIGRpc3RhbmNlIGNvbW11bmljYXRpb24iLAogICJzdGFydF91cmwiOiAiLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgInRoZW1lX2NvbG9yIjogIiMwMDAwMDAiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMwMDAwMDAiLAogICJvcmllbnRhdGlvbiI6ICJwb3J0cmFpdC1wcmltYXJ5IiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTVRJNElpQm9aV2xuYUhROUlqRXlPQ0lnZG1sbGQwSnZlRDBpTUNBd0lERXlPQ0F4TWpnaUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJK1BISmxZM1FnZUQwaU1TSWdlVDBpTVNJZ2QybGtkR2c5SWpFeU5pSWdhR1ZwWjJoMFBTSXhNall5SUdacGJHdzlJaU0yTmpkbFpXRWlMejQ4ZEdWNGRDQjRQU0kyTkNJZ2VUMGlOalFpSUdacGJHdzlJaU0zTWpZeUlpQm1iMjUwTFhOcGVtVTlJalEwSWlCbWIyNTBMWGRsYVdkb2REMGlPVEF3SWlCMFpYaDBMV0Z1WTJodmNqMGliV2xrWkd4bElpQmtiMjFwYm1GdWRDMWlZWE5sYkdsdVpUMGlZMlZ1ZEdWeUlqNUJaUzQ4TDNSbGVIUStQSFJsZUhRZ2VEMGlOalFpSUhrOUlqazFJaUJtYVd4c1BTSWpOekkyTWlJZ1ptOXVkQzF6YVhwbFBTSXpNaUlnWm05dWRDMTNaV2xuYUhROUlqZ3dNQ0lnZEdWNGRDMWhibU5vYjNJOUltMXBaR1JzWlNJZ1pHOXRhVzVoYm5RdFltRnpaV3hwYm1VOUltTmxiblJsY2lJK1dXOGhQQzl0WlhoMFBqd3ZjM1puUGc9PSIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiLAogICAgICAic2l6ZXMiOiAiMTI4eDEyOCIKICAgIH0KICBdLAogICJjYXRlZ29yaWVzIjogWyJ1dGlsaXRpZXMiLCAicHJvZHVjdGl2aXR5Il0sCiAgImxhbmciOiAiZW4iCn0K">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            color: #000;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 8px;
            color: #000;
        }

        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 40px;
            justify-content: center;
            align-items: center;
        }

        .btn {
            border: 2px solid #000;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            background: #fff;
            color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover {
            background: #000;
            color: #fff;
        }

        .btn-split {
            display: flex;
            border: 2px solid #000;
            border-radius: 50px;
            overflow: hidden;
            transition: all 0.2s ease;
        }

        .btn-split:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .btn-split-main {
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            background: #fff;
            color: #000;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            border-right: 1px solid #000;
        }

        .btn-split-main:hover {
            background: #64cf4e;
            color: #fff;
        }

        .btn-split-dropdown {
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            cursor: pointer;
            background: #fff;
            color: #000;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .btn-split-dropdown:hover {
            background: #64cf4e;
            color: #fff;
        }

        .btn-play {
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
        }
        
        .btn-play:hover {
            background: #0095ff;
            color: #fff;
        }

        .btn-clear {
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
        }
        
        .btn-clear:hover {
            background: #ff4d4d;
            color: #fff;
        }

        .btn-menu {
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #fff;
            min-width: 200px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border: 2px solid #000;
            border-radius: 12px;
            z-index: 1000;
            top: 60px;
            right: 0;
        }

        .dropdown-content.show {
            display: block;
        }

        .dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            font-weight: 600;
            border-bottom: 1px solid #eee;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background-color: #f5f5f5;
        }

        .dropdown-item.danger {
            color: #dc3545;
        }

        .dropdown-item.danger:hover {
            background-color: #dc3545;
            color: white;
        }

        .pages-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .page-item {
            position: relative;
            aspect-ratio: 16/9;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.2s ease;
            border: 2px solid #eee;
        }

        .page-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
            border-color: #000;
        }

        .page-preview {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Arial Black', Arial, sans-serif;
            font-weight: 900;
            text-align: center;
            line-height: 1.1;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 2rem;
            color: #fff;
            background: #000;
            position: relative;
            padding: 5%;
        }

        .page-text {
            width: 100%;
            height: 100%;
            background: transparent;
            border: none;
            outline: none;
            resize: none;
            font-family: inherit;
            font-weight: inherit;
            font-size: inherit;
            color: inherit;
            text-align: center;
            line-height: inherit;
            white-space: pre-wrap;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 0;
            left: 0;
            padding: 5%;
        }

        .page-controls {
            position: absolute;
            bottom: 12px;
            right: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(242, 242, 242, 0.9);
            border-radius: 24px;
            padding: 6px;
            transition: all 0.2s ease;
            z-index: 20;
        }

        .page-controls.collapsed {
            width: 48px;
            height: 48px;
            justify-content: center;
            background: transparent;
        }

        .page-controls.collapsed .control-btn:not(.toggle-btn) {
            display: none;
        }

        .control-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: transparent;
            color: #000;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .control-btn:hover {
            background: rgba(0,0,0,0.1);
        }

        .control-btn.toggle-btn {
            background: rgba(0, 0, 0, 0.24);
            color: white;
        }
        
        .control-btn.warning{
            background: rgba(255, 0, 0, 0);
        }
        
        .control-btn.warning:hover{
            background: rgba(255, 0, 0, 0.24);
        }

        .page-order-controls {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            background: rgba(255,255,255,0.9);
            border-radius: 8px;
            padding: 4px;
        }

        .order-btn {
            width: 24px;
            height: 20px;
            border: none;
            background: transparent;
            color: #000;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .order-btn:hover {
            background: rgba(0,0,0,0.1);
        }

        .order-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
        }

        .close-btn {
            position: absolute;
            top: 12px;
            right: 16px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: rgba(0,0,0,0.1);
            color: #000;
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
            position: relative;
        }

        .color-option:hover,
        .color-option.selected {
            border-color: #000;
            transform: scale(1.1);
        }

        .color-option::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: currentColor;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .color-option.selected::after {
            opacity: 1;
        }

        .option-group {
            margin-bottom: 20px;
        }

        .option-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .option-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .option-btn {
            padding: 8px 16px;
            background: #f5f5f5;
            border: 2px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .option-btn:hover,
        .option-btn.selected {
            background: #000;
            color: #fff;
            border-color: #000;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 8px;
            color: #000;
        }

        .empty-state p {
            margin-bottom: 12px;
        }

        .help-text {
            border-radius: 12px;
            padding: 20px;
            margin-top: 50px;
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .help-text strong {
            color: #000;
        }

        /* Fullscreen Display Mode */
        .display-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: none;
        }

        .display-text {
            font-weight: 900;
            text-align: center;
            line-height: 1.1;
            padding: 5%;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            word-wrap: break-word;
            hyphens: auto;
            white-space: pre-wrap;
        }

        .stop-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 10000;
            transition: all 0.3s ease;
        }

        .stop-btn:hover {
            background: rgba(255,0,0,0.8);
            transform: scale(1.1);
        }

        /* Animation Classes */
        .anim-fade-in { animation: fadeIn 0.5s ease-in; }
        .anim-slide-left { animation: slideInLeft 0.5s ease-out; }
        .anim-slide-right { animation: slideInRight 0.5s ease-out; }
        .anim-slide-up { animation: slideInUp 0.5s ease-out; }
        .anim-slide-down { animation: slideInDown 0.5s ease-out; }
        .anim-zoom-in { animation: zoomIn 0.5s ease-out; }
        .anim-pulse { animation: displayPulse 1s ease-in-out infinite; }
        .anim-drop { animation: dropIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        .anim-shake { animation: shake 0.5s ease-in-out infinite; }
        .anim-wipe { animation: wipeIn 0.8s ease-out; }
        .anim-flash { animation: flash 0.3s ease-in-out infinite; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInLeft { from { transform: translateX(-100vw); } to { transform: translateX(0); } }
        @keyframes slideInRight { from { transform: translateX(100vw); } to { transform: translateX(0); } }
        @keyframes slideInUp { from { transform: translateY(100vh); } to { transform: translateY(0); } }
        @keyframes slideInDown { from { transform: translateY(-100vh); } to { transform: translateY(0); } }
        @keyframes zoomIn { from { transform: scale(0.3); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes displayPulse { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.02); opacity: 0.95; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); } 20%, 40%, 60%, 80% { transform: translateX(8px); } }
        @keyframes wipeIn { 0% { clip-path: inset(0 100% 0 0); } 100% { clip-path: inset(0 0 0 0); } }
        @keyframes dropIn { 0% { transform: translateY(-100vh) scale(0.5); } 60% { transform: translateY(0) scale(1.05); } 100% { transform: translateY(0) scale(1); } }
        @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        @media (max-width: 768px) {
            .pages-container {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }

            .container {
                padding: 20px 16px;
            }

            .page-controls {
                position: absolute;
                bottom: 12px;
                right: 12px;
                z-index: 20;
            }

            .page-controls.collapsed {
                width: 48px;
                height: 48px;
            }
        }
    </style>
</head>
<body>
<div class="container" id="editMode">
    <div class="header">
        <h1>Yo!</h1>
        <p>A fullscreen text tool to get your message across. Fast, bold, and from far away.</p>
    </div>

    <div class="controls">
        <div class="btn-split">
            <button class="btn-split-main" onclick="addPage()" title="Add Page">+</button>
            <button class="btn-split-dropdown" onclick="toggleDropdown()" title="Templates">‚úß</button>
        </div>
        <button class="btn btn-play" onclick="startDisplay()" title="Play">‚ñ∂</button>
        <button class="btn btn-clear" onclick="clearAllPages()" title="Clear All">üóô</button>
        <div class="dropdown">
            <div class="dropdown-content" id="dropdown">
                <div class="dropdown-item" onclick="selectTemplate('airport')">‚úàÔ∏è Airport Meeting</div>
                <div class="dropdown-item" onclick="selectTemplate('emergency')">üö® Emergency</div>
                <div class="dropdown-item" onclick="selectTemplate('taxi')">üöï Taxi</div>
                <div class="dropdown-item" onclick="selectTemplate('birthday')">üéÇ Birthday</div>
                <div class="dropdown-item" onclick="selectTemplate('meeting')">üè¢ Meeting Room</div>
                <div class="dropdown-item" onclick="selectTemplate('slowdown')">üöó Slow Down</div>
                <div class="dropdown-item" onclick="selectTemplate('accident')">‚ö†Ô∏è Accident Ahead</div>
                <div class="dropdown-item" onclick="selectTemplate('protest')">üì¢ Protest Sign</div>
                <div class="dropdown-item" onclick="selectTemplate('sports')">üèÜ Go Team</div>
                <div class="dropdown-item" onclick="selectTemplate('onAir')">üé§ On Air</div>
                <div class="dropdown-item" onclick="selectTemplate('brb')">üïí Be right back</div>
            </div>
        </div>
    </div>

    <div class="pages-container" id="pagesContainer">
        <div class="empty-state" id="emptyState">
            <h3>No pages yet</h3>
            <p>Click the <strong>+</strong> button to add your first page</p>
            <p>Or try the <strong>‚ãØ</strong> menu for ready-made templates</p>
        </div>
    </div>
</div>

<!-- Modals -->
<div class="modal" id="fontModal">
    <div class="modal-content">
        <button class="close-btn" onclick="closeModal('fontModal')">&times;</button>
        <div class="modal-header">Font</div>
        <div class="option-buttons" id="fontOptions">
            <div class="option-btn" data-font="Arial Black, sans-serif" style="font-family: Arial Black, sans-serif;">Arial Black</div>
            <div class="option-btn" data-font="Impact, Arial Black, sans-serif" style="font-family: Impact, Arial Black, sans-serif;">Impact</div>
            <div class="option-btn" data-font="Georgia, serif" style="font-family: Georgia, serif;">Georgia</div>
            <div class="option-btn" data-font="Trebuchet MS, Arial, sans-serif" style="font-family: Trebuchet MS, Arial, sans-serif;">Trebuchet</div>
            <div class="option-btn" data-font="Verdana, Arial, sans-serif" style="font-family: Verdana, Arial, sans-serif;">Verdana</div>
            <div class="option-btn" data-font="Times New Roman, serif" style="font-family: Times New Roman, serif;">Times</div>
            <div class="option-btn" data-font="Courier New, monospace" style="font-family: Courier New, monospace;">Courier</div>
        </div>
    </div>
</div>

<div class="modal" id="animationModal">
    <div class="modal-content">
        <button class="close-btn" onclick="closeModal('animationModal')">&times;</button>
        <div class="modal-header">Animation</div>
        <div class="option-buttons" id="animationOptions">
            <div class="option-btn" data-animation="instant">Instant</div>
            <div class="option-btn" data-animation="pulse">Pulse</div>
            <div class="option-btn" data-animation="flash">Flash</div>
            <div class="option-btn" data-animation="shake">Shake</div>
            <div class="option-btn" data-animation="fade-in">Fade In</div>
            <div class="option-btn" data-animation="wipe">Wipe</div>
            <div class="option-btn" data-animation="slide-left">Slide Left</div>
            <div class="option-btn" data-animation="slide-right">Slide Right</div>
            <div class="option-btn" data-animation="slide-up">Slide Up</div>
            <div class="option-btn" data-animation="slide-down">Slide Down</div>
            <div class="option-btn" data-animation="zoom-in">Zoom In</div>
            <div class="option-btn" data-animation="drop">Drop In</div>
        </div>
    </div>
</div>

<div class="modal" id="colorModal">
    <div class="modal-content">
        <button class="close-btn" onclick="closeModal('colorModal')">&times;</button>
        <div class="modal-header">Colors</div>

        <div class="option-group">
            <label>Text Color</label>
            <div class="color-palette" id="textColorPalette">
                <div class="color-option" style="background-color: #ffffff; border-color: #ddd;" data-color="#ffffff" data-type="text"></div>
                <div class="color-option" style="background-color: #000000" data-color="#000000" data-type="text"></div>
                <div class="color-option" style="background-color: #ef4444" data-color="#ef4444" data-type="text"></div>
                <div class="color-option" style="background-color: #22c55e" data-color="#22c55e" data-type="text"></div>
                <div class="color-option" style="background-color: #3b82f6" data-color="#3b82f6" data-type="text"></div>
                <div class="color-option" style="background-color: #eab308" data-color="#eab308" data-type="text"></div>
                <div class="color-option" style="background-color: #a855f7" data-color="#a855f7" data-type="text"></div>
                <div class="color-option" style="background-color: #06b6d4" data-color="#06b6d4" data-type="text"></div>
                <div class="color-option" style="background-color: #f97316" data-color="#f97316" data-type="text"></div>
                <div class="color-option" style="background-color: #ec4899" data-color="#ec4899" data-type="text"></div>
                <div class="color-option" style="background-color: #84cc16" data-color="#84cc16" data-type="text"></div>
                <div class="color-option" style="background-color: #6366f1" data-color="#6366f1" data-type="text"></div>
            </div>
        </div>

        <div class="option-group">
            <label>Background Color</label>
            <div class="color-palette" id="backgroundColorPalette">
                <div class="color-option" style="background-color: #000000" data-color="#000000" data-type="background"></div>
                <div class="color-option" style="background-color: #ffffff; border-color: #ddd;" data-color="#ffffff" data-type="background"></div>
                <div class="color-option" style="background-color: #ef4444" data-color="#ef4444" data-type="background"></div>
                <div class="color-option" style="background-color: #22c55e" data-color="#22c55e" data-type="background"></div>
                <div class="color-option" style="background-color: #3b82f6" data-color="#3b82f6" data-type="background"></div>
                <div class="color-option" style="background-color: #eab308" data-color="#eab308" data-type="background"></div>
                <div class="color-option" style="background-color: #a855f7" data-color="#a855f7" data-type="background"></div>
                <div class="color-option" style="background-color: #06b6d4" data-color="#06b6d4" data-type="background"></div>
                <div class="color-option" style="background-color: #f97316" data-color="#f97316" data-type="background"></div>
                <div class="color-option" style="background-color: #ec4899" data-color="#ec4899" data-type="background"></div>
                <div class="color-option" style="background-color: #84cc16" data-color="#84cc16" data-type="background"></div>
                <div class="color-option" style="background-color: #6366f1" data-color="#6366f1" data-type="background"></div>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="durationModal">
    <div class="modal-content">
        <button class="close-btn" onclick="closeModal('durationModal')">&times;</button>
        <div class="modal-header">Duration (seconds)</div>
        <div class="option-buttons" id="durationOptions">
            <div class="option-btn" data-duration="0.1">0.1s</div>
            <div class="option-btn" data-duration="0.2">0.2s</div>
            <div class="option-btn" data-duration="0.5">0.5s</div>
            <div class="option-btn" data-duration="1">1s</div>
            <div class="option-btn" data-duration="2">2s</div>
            <div class="option-btn" data-duration="3">3s</div>
            <div class="option-btn" data-duration="4">4s</div>
            <div class="option-btn" data-duration="5">5s</div>
            <div class="option-btn" data-duration="10">10s</div>
        </div>
    </div>
</div>

<script>
    let pages = [];
    let currentPageIndex = 0;
    let currentPageId = null;
    let displayInterval = null;
    let isPlaying = false;

    // Load saved pages on startup
    document.addEventListener('DOMContentLoaded', function() {
        loadPages();
        renderPages();
        registerServiceWorker();

        // Set up resize handlers
        handleResize();
    });

    // Register Service Worker for PWA functionality
    function registerServiceWorker() {
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'yo-v3';
                const urlsToCache = ['/'];
                self.addEventListener('install', function(event) {
                    event.waitUntil(caches.open(CACHE_NAME).then(function(cache) {
                        return cache.addAll(urlsToCache);
                    }));
                });
                self.addEventListener('fetch', function(event) {
                    event.respondWith(caches.match(event.request).then(function(response) {
                        return response || fetch(event.request);
                    }));
                });
            `;
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            navigator.serviceWorker.register(swUrl);
        }
    }

    function loadPages() {
        const saved = localStorage.getItem('yoPages');
        if (saved) {
            pages = JSON.parse(saved);
        }
    }

    function savePages() {
        localStorage.setItem('yoPages', JSON.stringify(pages));
    }

    function addPage() {
        const page = {
            id: Date.now(),
            text: 'NEW\nPAGE',
            fontFamily: 'Arial Black, sans-serif',
            textColor: '#ffffff',
            backgroundColor: '#000000',
            animation: 'instant',
            duration: 2
        };
        pages.push(page);
        savePages();
        renderPages();
    }

    function deletePage(id) {
        pages = pages.filter(page => page.id !== id);
        savePages();
        renderPages();
    }

    function duplicatePage(id) {
        const page = pages.find(p => p.id === id);
        if (page) {
            const duplicate = { ...page, id: Date.now() };
            const index = pages.findIndex(p => p.id === id);
            pages.splice(index + 1, 0, duplicate);
            savePages();
            renderPages();
        }
    }

    function clearAllPages() {
        if (confirm('Clear all pages? This cannot be undone.')) {
            pages = [];
            savePages();
            renderPages();
        }
        toggleDropdown();
    }

    function selectTemplate(type) {
        // Clear existing pages first
        pages = [];

        let templatePages = [];

        switch(type) {
            case 'airport':
                templatePages = [
                    {
                        id: Date.now(),
                        text: 'PICKING UP',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#000000',
                        backgroundColor: '#ffffff',
                        animation: 'instant',
                        duration: 2
                    },
                    {
                        id: Date.now() + 1,
                        text: 'YOUR\nNAME',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#ffffff',
                        backgroundColor: '#3b82f6',
                        animation: 'instant',
                        duration: 3
                    }
                ];
                break;
            case 'emergency':
                templatePages = [
                    {
                        id: Date.now(),
                        text: 'HELP',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#ffffff',
                        backgroundColor: '#ef4444',
                        animation: 'flash',
                        duration: 2
                    },
                    {
                        id: Date.now() + 1,
                        text: 'CALL\n911',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#ffffff',
                        backgroundColor: '#ef4444',
                        animation: 'instant',
                        duration: 3
                    }
                ];
                break;
            case 'taxi':
                templatePages = [
                    {
                        id: Date.now(),
                        text: 'TAXI',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#000000',
                        backgroundColor: '#eab308',
                        animation: 'flash',
                        duration: 2
                    },
                    {
                        id: Date.now() + 1,
                        text: 'GOING TO\nAIRPORT',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#000000',
                        backgroundColor: '#ffffff',
                        animation: 'instant',
                        duration: 3
                    }
                ];
                break;
            case 'birthday':
                templatePages = [
                    {
                        id: Date.now(),
                        text: 'üéâ\nHAPPY',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#ffffff',
                        backgroundColor: '#a855f7',
                        animation: 'pulse',
                        duration: 1
                    },
                    {
                        id: Date.now() + 1,
                        text: 'üéà\nBIRTHDAY',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#ffffff',
                        backgroundColor: '#a855f7',
                        animation: 'pulse',
                        duration: 1
                    },
                    {
                        id: Date.now() + 2,
                        text: '‚ù§\nNAME!',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#ffffff',
                        backgroundColor: '#ec4899',
                        animation: 'pulse',
                        duration: 3
                    }
                ];
                break;
            case 'meeting':
                templatePages = [
                    {
                        id: Date.now(),
                        text: 'TEAM\nMEETING',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#ffffff',
                        backgroundColor: '#3b82f6',
                        animation: 'flash',
                        duration: 2
                    },
                    {
                        id: Date.now() + 1,
                        text: 'Room A1\nTHIS WAY',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#ffffff',
                        backgroundColor: '#22c55e',
                        animation: 'instant',
                        duration: 2
                    }
                ];
                break;
            case 'slowdown':
                templatePages = [
                    {
                        id: Date.now(),
                        text: 'SLOW\nDOWN',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#000000',
                        backgroundColor: '#eab308',
                        animation: 'instant',
                        duration: 3
                    },
                    {
                        id: Date.now() + 1,
                        text: 'SLOW\nDOWN',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#000000',
                        backgroundColor: '#eab308',
                        animation: 'flash',
                        duration: 2
                    }
                ];
                break;
            case 'accident':
                templatePages = [
                    {
                        id: Date.now(),
                        text: 'üö®',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#ffffff',
                        backgroundColor: '#ef4444',
                        animation: 'flash',
                        duration: 1
                    },
                    {
                        id: Date.now() + 1,
                        text: 'ACCIDENT\nAHEAD',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#000000',
                        backgroundColor: '#eab308',
                        animation: 'pulse',
                        duration: 3
                    }
                ];
                break;
            case 'protest':
                templatePages = [
                    {
                        id: Date.now(),
                        text: 'CHANGE',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#ffffff',
                        backgroundColor: '#000000',
                        animation: 'drop',
                        duration: 1
                    },
                    {
                        id: Date.now() + 1,
                        text: 'NOW!',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#000000',
                        backgroundColor: '#ffffff',
                        animation: 'drop',
                        duration: 1
                    }
                ];
                break;
            case 'sports':
                templatePages = [
                    {
                        id: Date.now(),
                        text: 'LET\'S',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#000000',
                        backgroundColor: '#ffffff',
                        animation: 'instant',
                        duration: 0.5
                    },
                    {
                        id: Date.now() + 1,
                        text: 'GO',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#000000',
                        backgroundColor: '#ffffff',
                        animation: 'instant',
                        duration: 0.5
                    },
                    {
                        id: Date.now() + 2,
                        text: 'üèÜ\nTEAM!',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#000000',
                        backgroundColor: '#eab308',
                        animation: 'shake',
                        duration: 1
                    }
                ];
                break;
            case 'onAir':
                templatePages = [
                    {
                        id: Date.now(),
                        text: 'ON AIR',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#ffffff',
                        backgroundColor: '#ef4444',
                        animation: 'pulse',
                        duration: 2
                    },
                    {
                        id: Date.now() + 1,
                        text: 'ü§´\nQUIET',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#ffffff',
                        backgroundColor: '#000000',
                        animation: 'flash',
                        duration: 2
                    }
                ];
                break;
            case 'brb':
                templatePages = [
                    {
                        id: Date.now(),
                        text: 'Be Right\nBack',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#ffffff',
                        backgroundColor: '#3b82f6',
                        animation: 'fade-in',
                        duration: 5
                    },
                    {
                        id: Date.now() + 1,
                        text: 'üèÉ‚Äç‚ôÇÔ∏èüí®',
                        fontFamily: 'Arial Black, sans-serif',
                        textColor: '#ffffff',
                        backgroundColor: '#000000',
                        animation: 'slide-right',
                        duration: 2
                    }
                ];
                break;
        }

        pages = templatePages;
        savePages();
        renderPages();
        toggleDropdown(); // Close dropdown
    }

    function toggleDropdown() {
        document.getElementById('dropdown').classList.toggle('show');
    }

    // Close dropdown when clicking outside
    window.onclick = function(event) {
        if (!event.target.matches('.btn-split-dropdown')) {
            const dropdown = document.getElementById('dropdown');
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
            }
        }
    }

    function renderPages() {
        const container = document.getElementById('pagesContainer');

        if (pages.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <h3>No pages yet</h3>
                    <p>Click the <strong>+</strong> button to add your first page</p>
                    <p>Or try the <strong>‚úß</strong> button for ready-made templates</p>
                </div>
            `;
            return;
        }

        const pagesHTML = pages.map((page, index) => createPageHTML(page, index)).join('');
        const helpHTML = `
            <div class="help-text">
                <strong>üí° Quick Tips:</strong><br><br>
                Tap a page to edit its text<br>Tap <b>(‚Ä¶)</b> to customize colors & animations<br>Hit ‚ñ∂ to play fullscreen
            </div>
        `;

        container.innerHTML = pagesHTML + helpHTML;
        attachPageEventListeners();
    }

    function createPageHTML(page, index) {
        const isFirst = index === 0;
        const isLast = index === pages.length - 1;

        return `
            <div class="page-item" data-page-id="${page.id}">
                <div class="page-order-controls">
                    <button class="order-btn" onclick="movePageUp(${page.id})" ${isFirst ? 'disabled' : ''} title="Move Up">‚ñ≤</button>
                    <button class="order-btn" onclick="movePageDown(${page.id})" ${isLast ? 'disabled' : ''} title="Move Down">‚ñº</button>
                </div>
                <div class="page-preview" style="font-family: ${page.fontFamily}; color: ${page.textColor}; background: ${page.backgroundColor};">
                    <textarea class="page-text" data-page-id="${page.id}" placeholder="Enter text..." spellcheck="false">${page.text}</textarea>
                    <div class="page-controls collapsed" id="controls-${page.id}">
                        <div class="control-btn" onclick="openModal('fontModal', ${page.id})" title="Font">A</div>
                        <div class="control-btn" onclick="openModal('animationModal', ${page.id})" title="Animation">‚ö°</div>
                        <div class="control-btn" onclick="openModal('colorModal', ${page.id})" title="Colors">üé®</div>
                        <div class="control-btn" onclick="openModal('durationModal', ${page.id})" title="Duration">‚è≥</div>
                        <div class="control-btn" onclick="duplicatePage(${page.id})" title="Duplicate">‚ßâ</div>
                        <div class="control-btn warning" onclick="deletePage(${page.id})" title="Delete">üóëÔ∏è</div>
                        <div class="control-btn toggle-btn" onclick="toggleControls(${page.id})" title="Controls">‚Ä¶</div>
                    </div>
                </div>
            </div>
        `;
    }

    function attachPageEventListeners() {
        const container = document.getElementById('pagesContainer');

        // Handle text changes
        container.addEventListener('input', function(e) {
            if (e.target.classList.contains('page-text')) {
                const pageId = parseInt(e.target.getAttribute('data-page-id'));
                updatePage(pageId, 'text', e.target.value);
                adjustTextSize(e.target);
            }
        });

        // Adjust text size for all textareas
        document.querySelectorAll('.page-text').forEach(adjustTextSize);
    }

    // Handle orientation changes and window resizes
    function handleResize() {
        // Only re-adjust preview text if we're in edit mode
        if (!isPlaying) {
            document.querySelectorAll('.page-text').forEach(adjustTextSize);
        }
    }

    // Listen for orientation changes and window resizes
    window.addEventListener('resize', handleResize);
    window.addEventListener('orientationchange', function() {
        // Small delay to ensure the viewport has updated
        setTimeout(handleResize, 100);
    });

    function adjustTextSize(textarea) {
        const container = textarea.parentElement;
        const text = textarea.value || textarea.placeholder;

        // Use the same algorithm as display mode for consistency
        const fontSize = calculatePreviewFontSize(text, container);
        textarea.style.fontSize = fontSize + 'px';
    }

    function calculatePreviewFontSize(text, container) {
        // Use the same aggressive sizing as display mode
        const maxWidth = container.clientWidth * 0.9; // 5% padding on each side
        const maxHeight = container.clientHeight * 0.9;

        // Account for animation scaling with same buffer as display
        const safeMaxWidth = maxWidth / 1.05;
        const safeMaxHeight = maxHeight / 1.05;

        const lines = text.split('\n');
        const longestLine = lines.reduce((longest, line) =>
            line.length > longest.length ? line : longest, '');

        let fontSize = Math.min(
            safeMaxWidth / (longestLine.length * 0.65), // Same as display
            safeMaxHeight / (lines.length * 1.2) // Same as display
        );

        // Create test element to measure actual size (same as display)
        const testElement = document.createElement('div');
        testElement.style.position = 'absolute';
        testElement.style.visibility = 'hidden';
        testElement.style.fontSize = fontSize + 'px';
        testElement.style.lineHeight = '1.1';
        testElement.style.whiteSpace = 'pre-wrap';
        testElement.style.wordWrap = 'break-word';
        testElement.style.fontFamily = container.style.fontFamily;
        testElement.style.fontWeight = '900';
        testElement.style.textAlign = 'center';
        testElement.style.maxWidth = safeMaxWidth + 'px';
        testElement.textContent = text;

        document.body.appendChild(testElement);

        // Fine-tune size more aggressively (same as display)
        while (testElement.offsetWidth < safeMaxWidth * 0.8 &&
        testElement.offsetHeight < safeMaxHeight * 0.8 &&
        fontSize < 800) {
            fontSize *= 1.06;
            testElement.style.fontSize = fontSize + 'px';
        }

        while ((testElement.offsetWidth > safeMaxWidth ||
            testElement.offsetHeight > safeMaxHeight) &&
        fontSize > 16) {
            fontSize *= 0.96;
            testElement.style.fontSize = fontSize + 'px';
        }

        document.body.removeChild(testElement);
        return Math.max(fontSize, 16);
    }

    function toggleControls(pageId) {
        const controls = document.getElementById(`controls-${pageId}`);
        controls.classList.toggle('collapsed');
    }

    function movePageUp(pageId) {
        const index = pages.findIndex(p => p.id === pageId);
        if (index > 0) {
            [pages[index], pages[index - 1]] = [pages[index - 1], pages[index]];
            savePages();
            renderPages();
        }
    }

    function movePageDown(pageId) {
        const index = pages.findIndex(p => p.id === pageId);
        if (index < pages.length - 1) {
            [pages[index], pages[index + 1]] = [pages[index + 1], pages[index]];
            savePages();
            renderPages();
        }
    }

    function updatePage(id, field, value) {
        const page = pages.find(p => p.id === id);
        if (page) {
            page[field] = value;
            savePages();
            if (field !== 'text') {
                renderPages();
            }
        }
    }

    function openModal(modalId, pageId) {
        currentPageId = pageId;
        const modal = document.getElementById(modalId);
        modal.classList.add('show');

        updateModalSelections(modalId, pageId);
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('show');
    }

    function updateModalSelections(modalId, pageId) {
        const page = pages.find(p => p.id === pageId);
        if (!page) return;

        // Clear previous selections
        document.querySelectorAll(`#${modalId} .selected`).forEach(el => {
            el.classList.remove('selected');
        });

        // Set current selection
        if (modalId === 'fontModal') {
            document.querySelector(`#fontOptions [data-font="${page.fontFamily}"]`)?.classList.add('selected');
        } else if (modalId === 'animationModal') {
            document.querySelector(`#animationOptions [data-animation="${page.animation}"]`)?.classList.add('selected');
        } else if (modalId === 'colorModal') {
            document.querySelector(`#textColorPalette [data-color="${page.textColor}"]`)?.classList.add('selected');
            document.querySelector(`#backgroundColorPalette [data-color="${page.backgroundColor}"]`)?.classList.add('selected');
        } else if (modalId === 'durationModal') {
            document.querySelector(`#durationOptions [data-duration="${page.duration}"]`)?.classList.add('selected');
        }
    }

    // Modal option click handlers
    document.addEventListener('click', function(e) {
        // Close modals when clicking outside
        if (e.target.classList.contains('modal')) {
            e.target.classList.remove('show');
            return;
        }

        if (e.target.hasAttribute('data-font')) {
            updatePage(currentPageId, 'fontFamily', e.target.getAttribute('data-font'));
            closeModal('fontModal');
        } else if (e.target.hasAttribute('data-animation')) {
            updatePage(currentPageId, 'animation', e.target.getAttribute('data-animation'));
            closeModal('animationModal');
        } else if (e.target.hasAttribute('data-color')) {
            const colorType = e.target.getAttribute('data-type');
            if (colorType === 'text') {
                updatePage(currentPageId, 'textColor', e.target.getAttribute('data-color'));
            } else if (colorType === 'background') {
                updatePage(currentPageId, 'backgroundColor', e.target.getAttribute('data-color'));
            }
            // Don't close color modal - let user adjust both colors if needed
        } else if (e.target.hasAttribute('data-duration')) {
            updatePage(currentPageId, 'duration', parseFloat(e.target.getAttribute('data-duration')));
            closeModal('durationModal');
        }
    });

    async function startDisplay() {
        if (pages.length === 0) {
            alert('Add some pages first!');
            return;
        }

        currentPageIndex = 0;
        isPlaying = true;

        // Hide edit mode
        document.getElementById('editMode').style.display = 'none';

        // Create display container
        const displayContainer = document.createElement('div');
        displayContainer.className = 'display-mode';
        displayContainer.id = 'displayContainer';

        // Add stop button
        const stopButton = document.createElement('button');
        stopButton.className = 'stop-btn';
        stopButton.innerHTML = '√ó';
        stopButton.onclick = stopDisplay;
        displayContainer.appendChild(stopButton);

        // Add text container
        const textContainer = document.createElement('div');
        textContainer.className = 'display-text';
        textContainer.id = 'displayText';
        displayContainer.appendChild(textContainer);

        document.body.appendChild(displayContainer);

        // Try to enter fullscreen first
        try {
            if (displayContainer.requestFullscreen) {
                await displayContainer.requestFullscreen();
            }
        } catch (err) {
            console.log('Fullscreen not available:', err);
        }

        // Try to lock orientation to landscape on mobile
        try {
            if (screen.orientation && screen.orientation.lock) {
                await screen.orientation.lock('landscape');
                // Wait a bit longer for orientation to fully apply
                await new Promise(resolve => setTimeout(resolve, 300));
            }
        } catch (err) {
            console.log('Orientation lock not available or failed:', err);
            // Continue anyway - not critical
        }

        // Start showing pages
        showPage(0);
    }

    function showPage(index) {
        if (!isPlaying || index >= pages.length) {
            if (isPlaying) {
                // Loop back to start
                showPage(0);
            }
            return;
        }

        const page = pages[index];
        const displayText = document.getElementById('displayText');

        // Clear previous classes
        displayText.className = 'display-text';

        // Set page properties
        displayText.style.fontFamily = page.fontFamily;
        displayText.style.color = page.textColor;
        displayText.style.background = page.backgroundColor;

        // Calculate and set font size with more conservative margins
        displayText.textContent = page.text;
        const fontSize = calculateDisplayFontSize(page.text, displayText);
        displayText.style.fontSize = fontSize + 'px';

        // Add animation
        if (page.animation !== 'instant') {
            displayText.classList.add('anim-' + page.animation);
        }

        // Schedule next page
        clearTimeout(displayInterval);
        displayInterval = setTimeout(() => {
            showPage(index + 1);
        }, page.duration * 1000);
    }

    function calculateDisplayFontSize(text, container) {
        // More aggressive sizing - reduce margins to make text as big as possible
        const maxWidth = container.clientWidth * 0.95; // Increased from 0.85
        const maxHeight = container.clientHeight * 0.95; // Increased from 0.85

        // Account for animation scaling with smaller buffer
        const safeMaxWidth = maxWidth / 1.05; // Reduced from 1.1
        const safeMaxHeight = maxHeight / 1.05;

        const lines = text.split('\n');
        const longestLine = lines.reduce((longest, line) =>
            line.length > longest.length ? line : longest, '');

        let fontSize = Math.min(
            safeMaxWidth / (longestLine.length * 0.65), // Slightly more aggressive
            safeMaxHeight / (lines.length * 1.2)
        );

        // Create test element to measure actual size
        const testElement = document.createElement('div');
        testElement.style.position = 'absolute';
        testElement.style.visibility = 'hidden';
        testElement.style.fontSize = fontSize + 'px';
        testElement.style.lineHeight = '1.1';
        testElement.style.whiteSpace = 'pre-wrap';
        testElement.style.wordWrap = 'break-word';
        testElement.style.fontFamily = container.style.fontFamily;
        testElement.style.fontWeight = '900';
        testElement.style.textAlign = 'center';
        testElement.textContent = text;

        document.body.appendChild(testElement);

        // Fine-tune size more aggressively
        while (testElement.offsetWidth < safeMaxWidth * 0.8 &&
        testElement.offsetHeight < safeMaxHeight * 0.8 &&
        fontSize < 800) {
            fontSize *= 1.06; // Slightly larger increments
            testElement.style.fontSize = fontSize + 'px';
        }

        while ((testElement.offsetWidth > safeMaxWidth ||
            testElement.offsetHeight > safeMaxHeight) &&
        fontSize > 16) {
            fontSize *= 0.96; // Smaller decrements
            testElement.style.fontSize = fontSize + 'px';
        }

        document.body.removeChild(testElement);
        return Math.max(fontSize, 16);
    }

    function stopDisplay() {
        isPlaying = false;
        clearTimeout(displayInterval);

        // Unlock orientation
        try {
            if (screen.orientation && screen.orientation.unlock) {
                screen.orientation.unlock();
            }
        } catch (err) {
            console.log('Orientation unlock failed:', err);
        }

        // Exit fullscreen
        if (document.exitFullscreen) {
            document.exitFullscreen();
        }

        // Remove display container
        const displayContainer = document.getElementById('displayContainer');
        if (displayContainer) {
            displayContainer.remove();
        }

        // Show edit mode
        document.getElementById('editMode').style.display = 'block';

        // Re-adjust preview text sizes after returning to edit mode
        setTimeout(() => {
            document.querySelectorAll('.page-text').forEach(adjustTextSize);
        }, 100);
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            if (isPlaying) {
                stopDisplay();
            } else {
                // Close any open modals
                document.querySelectorAll('.modal.show').forEach(modal => {
                    modal.classList.remove('show');
                });
            }
        }
    });

    // Handle fullscreen change
    document.addEventListener('fullscreenchange', function() {
        if (!document.fullscreenElement && isPlaying) {
            stopDisplay();
        }
    });

    // Handle orientation change during play (recalculate text size)
    document.addEventListener('orientationchange', function() {
        if (isPlaying) {
            setTimeout(() => {
                const displayText = document.getElementById('displayText');
                if (displayText && pages[currentPageIndex]) {
                    const page = pages[currentPageIndex];
                    displayText.textContent = page.text;
                    const fontSize = calculateDisplayFontSize(page.text, displayText);
                    displayText.style.fontSize = fontSize + 'px';
                }
            }, 100);
        }
    });
</script>
</body>
</html>